<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Router Geist 2</title>
  <link rel="stylesheet" href="/static/style.css" />
  <script defer src="/static/app.js"></script>
  <link rel="icon" href="data:," />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data:; connect-src 'self';" />
  <meta name="color-scheme" content="dark light" />
  <meta name="referrer" content="no-referrer" />
</head>
<body>
  <header>
    <h1>Router Geist 2</h1>
  </header>
  <div class="tabs">
    <button class="tab active" data-tab="interfaces">Interfaces</button>
    <button class="tab" data-tab="security">Security</button>
    <button class="tab" data-tab="analytics">Analytics</button>
    <button class="tab" data-tab="settings">Settings</button>
    <button class="tab" data-tab="maintenance">Maintenance</button>
    <button class="tab" data-tab="router">Router</button>
  </div>
  <main>
    <div class="tab-pane active" id="tab-interfaces">
      <section class="card">
        <h2>Interfaces</h2>
        <div id="interfaces"></div>
      </section>
    </div>
    <div class="tab-pane" id="tab-security">
      <section class="card">
        <h2>Threats</h2>
        <div id="threats"></div>
        <details class="mt-10"><summary class="muted">How decisions are made</summary>
          <p class="muted">Alerts from LLM analysis, Suricata IDS, and flow heuristics are displayed here. High/critical events with identifiable IPs are auto-blocked. You can block additional IPs below.</p>
        </details>
      </section>
      <section class="card">
        <h2>Firewall</h2>
        <div class="row">
          <input id="blockIp" placeholder="Block IP (e.g., 1.2.3.4)" />
          <button id="blockIpBtn">Block</button>
        </div>
        <div id="blocklist"></div>
      </section>
    </div>
    <div class="tab-pane" id="tab-analytics">
      <section class="card card-traffic">
        <h2 class="m-0">Traffic</h2>
        <div class="row wrap gap-16">
          <div class="flex-1">
            <div class="row justify-between"><h3 class="m-0">WAN</h3><span id="wanNicName" class="muted"></span></div>
            <canvas id="trafficChartWan" class="traffic" height="220"></canvas>
          </div>
          <div class="flex-1">
            <div class="row justify-between"><h3 class="m-0">LAN / AP</h3><span id="lanNicName" class="muted"></span></div>
            <canvas id="trafficChartLan" class="traffic" height="220"></canvas>
          </div>
        </div>
      </section>
      <section class="card card-traffic">
        <h2 class="m-0">Long‑term Activity</h2>
        <div class="row wrap gap-16">
          <div class="flex-1">
            <h3 class="m-0">Last 24 hours (WAN)</h3>
            <canvas id="lt24" class="traffic" height="220"></canvas>
          </div>
          <div class="flex-1">
            <h3 class="m-0">Last 7 days (WAN)</h3>
            <canvas id="lt7d" class="traffic" height="220"></canvas>
          </div>
        </div>
      </section>
      <section class="card">
        <h2>Visited Domains</h2>
        <div id="domains"></div>
      </section>
      <section class="card">
        <h2>Top Domains (10 min)</h2>
        <div id="topDomains"></div>
      </section>
      <section class="card">
        <h2>Top Domains by Client</h2>
        <div id="topDomainsByClient"></div>
      </section>
      <section class="card">
        <h2>Clients per Domain (10 min)</h2>
        <div id="clientsByDomain"></div>
      </section>
      <section class="card">
        <h2>New Domains (last hour)</h2>
        <div id="newDomains"></div>
      </section>
      <section class="card">
        <h2>Summary</h2>
        <div id="summary"></div>
      </section>
      <section class="card">
        <h2>Connections</h2>
        <div id="connections"></div>
      </section>
      <section class="card card-activity">
        <h2>Activity by Device</h2>
        <div id="activity"></div>
      </section>
    </div>
    <div class="tab-pane" id="tab-settings">
      <section class="card">
        <h2>Settings</h2>
        <div class="row col gap-8">
          <div>
            <label class="muted">OpenAI API Key <span id="openaiState" class="badge">—</span></label>
            <div class="row">
              <input id="openaiKey" placeholder="sk-..." type="password" class="flex-1" />
              <button id="saveKeyBtn">Save</button>
            </div>
          </div>
          <div>
            <label class="muted">Change Password</label>
            <div class="row wrap">
              <input id="curPass" placeholder="Current password" type="password" />
              <input id="newPass" placeholder="New password" type="password" />
              <button id="pwUpdateBtn">Update</button>
            </div>
            <div id="pwMsg" class="muted"></div>
          </div>
          <div id="settingsMsg" class="muted"></div>
          <hr style="border:0;border-top:1px solid var(--border);width:100%" />
          <div>
            <label class="muted">Session</label>
            <div class="row">
              <button id="logoutBtn">Log out</button>
              <small class="muted">Clears this device's session cookie.</small>
            </div>
          </div>
        </div>
      </section>
    </div>
    <div class="tab-pane" id="tab-router">
      <section class="card">
        <h2>Router Configuration</h2>
        <div id="routerCfg"></div>
        <div id="routerForm" class="col gap-8 mt-10"></div>
        <div class="mt-10">
          <h3 class="m-0">Port Forward</h3>
          <div class="row wrap">
            <select id="fwdProto"><option>tcp</option><option>udp</option></select>
            <input id="fwdIn" placeholder="External port" />
            <input id="fwdIp" placeholder="Destination IP" />
            <input id="fwdDest" placeholder="Destination port" />
            <button id="fwdAddBtn">Add</button>
          </div>
          <div id="forwards"></div>
          <div class="mt-10">
            <button id="applyRouterBtn">Apply Router Config</button>
            <pre id="applyOut" class="pre-wrap"></pre>
          </div>
          <div class="mt-10">
            <h3 class="m-0">Services</h3>
            <div id="services"></div>
            <div class="row wrap">
              <button id="svcRefreshBtn">Refresh Status</button>
              <button id="svcRestartDnsmasq">Restart dnsmasq</button>
              <button id="svcRestartHostapd">Restart hostapd</button>
            </div>
          </div>
        </div>
      </section>
    </div>
    <div class="tab-pane" id="tab-maintenance">
      <section class="card danger">
        <h2>Nuke</h2>
        <p>Shred application data and reset. Type "NUKE" to confirm.</p>
        <div class="row">
          <input id="confirm" placeholder="Type NUKE" />
          <label><input type="checkbox" id="full_device" /> Full device wipe (if enabled)</label>
        </div>
        <button id="nukeBtn" class="nuke">Nuke</button>
        <div id="nukeMsg" class="muted"></div>
      </section>
    </div>
  </main>
  <div id="modal">
    <div class="modal-card">
        <div class="row justify-between"><h3 class="m-0">Why Blocked</h3><button class="small" id="modalCloseBtn">Close</button></div>
      <pre id="modalBody" class="pre-wrap"></pre>
    </div>
  </div>
  <footer>
    <small>&copy; 2025 Router Geist</small>
  </footer>
</body>
</html>


